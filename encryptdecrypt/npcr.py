from PIL import Image
import numpy as np


"""
    NPCR(Number of pixel changed rate).our code compares the pixel values of the original image and the encrypted image.
    The resultant value is returned in percentage.If the value is more than 99% then the encryption system is considered as high resistance to different attacks analysis is positive.
    
    It consist of three modules rateofchange(),sumofpixel(),npcrv().
"""


"""
    This method compares two image.If the pixel value is same then 0 is stored in the matrix else one is stored
"""
def rateofchange(height,width,pixel1,pixel2,matrix,i):

    for y in range(0,height):
        for x in range(0,width):
            #print(x,y)
            if pixel1[x,y][i] == pixel2[x,y][i]:
                matrix[x,y]=0
            else:
                matrix[x,y]=1
    return matrix
"""
    sum of the values of 1 stored in matrix is calculated
"""
def sumofpixel(height,width,pixel1,pixel2,ematrix,i):
    matrix=rateofchange(height,width,pixel1,pixel2,ematrix,i)
    psum=0
    for y in range(0,height):
        for x in range(0,width):
            psum=matrix[x,y]+psum
    return psum

"""
Finally the above two module is called to calculate the values
"""
def npcrv(loc1,loc2):
    c1 = Image.open(loc1)
    c2 = Image.open(loc2)
    width, height = c1.size
    pixel1 = c1.load()
    pixel2 = c2.load()
    ematrix = np.empty([width, height])
    per=(((sumofpixel(height,width,pixel1,pixel2,ematrix,0)/(height*width))*100)+((sumofpixel(height,width,pixel1,pixel2,ematrix,1)/(height*width))*100)+((sumofpixel(height,width,pixel1,pixel2,ematrix,2)/(height*width))*100))/3
    return per

#print(npcrv("C:\\Users\\Dell\\OneDrive\\Desktop\\encryptdecrypt\\Merged_image.jpg","C:\\Users\\Dell\\OneDrive\\Desktop\\encryptdecrypt\\encrypted_image.jpg"))



